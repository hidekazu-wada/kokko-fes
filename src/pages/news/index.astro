---
// コンポーネント
import PageLayout from "../../layouts/PageLayout.astro";
import PageBottomWave from "../../components/common/PageBottomWave.astro";
import Breadcrumb from "../../components/common/Breadcrumb.astro";
import NewsArticleList from "../../components/common/NewsArticleList.astro";
import PageTitle from "../../components/common/PageTitle.astro";

// データとタイプ
import newsData from "../../data/news.json";
import type { NewsData } from "../../types/news.ts";

// データの型変換（カテゴリフィルター用）
const typedNewsData = newsData as NewsData;
const categories = typedNewsData.categories;
---

<PageLayout title="お知らせ一覧 ｜コッコ祭り 2025｜KOKKO Festival">
  <!-- news list content -->
  <section class="page-wrapper news-list">
    <div class="news-list__container">
      <PageTitle accent="お" title="知らせ" subtitle="NEWS" />
      <nav class="news-filter">
        <div class="news-filter__wrapper">
          <button
            class="news-filter__item news-filter__item--active"
            data-category="all"
          >
            <span>すべて</span>
          </button>
          {
            categories.map((category) => (
              <button class="news-filter__item" data-category={category.id}>
                <span>{category.name}</span>
              </button>
            ))
          }
        </div>
      </nav>
      <main class="news-articles">
        <NewsArticleList className="news-articles__list" />
      </main>
      <!-- <nav class="news-pagination" aria-label="ページネーション">
        <button class="news-pagination__item news-pagination__item--prev"
          ><span class="news-pagination__text">＜</span></button
        >
        <button class="news-pagination__item news-pagination__item--current"
          ><span class="news-pagination__text">1</span></button
        >
        <button class="news-pagination__item"
          ><span class="news-pagination__text">2</span></button
        >
        <button class="news-pagination__item"
          ><span class="news-pagination__text">3</span></button
        >
        <button class="news-pagination__item"
          ><span class="news-pagination__text">4</span></button
        >
        <button class="news-pagination__item"
          ><span class="news-pagination__text">5</span></button
        >
        <button class="news-pagination__item news-pagination__item--next"
          ><span class="news-pagination__text">＞</span></button
        >
      </nav> -->
      <!-- ここにお知らせ一覧のマークアップを追加 -->
    </div>
    <Breadcrumb currentPageTitle="お知らせ" />
    <PageBottomWave />
  </section>
</PageLayout>

<script>
  // お知らせ一覧ページのJavaScript
  document.addEventListener("DOMContentLoaded", () => {
    // フィルター機能の実装
    const filterButtons = document.querySelectorAll(".news-filter__item");
    const newsItems = document.querySelectorAll(".news-articles__item");

    // フィルターボタンのクリックイベント
    filterButtons.forEach((button) => {
      button.addEventListener("click", () => {
        const targetCategory = button.getAttribute("data-category");

        // アクティブボタンの切り替え
        filterButtons.forEach((btn) =>
          btn.classList.remove("news-filter__item--active"),
        );
        button.classList.add("news-filter__item--active");

        // 記事のフィルタリング
        newsItems.forEach((item, index) => {
          const htmlItem = item as HTMLElement;
          const itemCategory = htmlItem.getAttribute("data-category");

          if (targetCategory === "all" || itemCategory === targetCategory) {
            // 表示する要素：段階的にフェードイン
            htmlItem.style.display = "block";
            htmlItem.style.opacity = "0";
            htmlItem.style.transform = "translateY(20px)";
            htmlItem.style.transition =
              "opacity 0.3s ease, transform 0.3s ease";

            // 少しずつ遅延させて順番にフェードイン
            setTimeout(
              () => {
                htmlItem.style.opacity = "1";
                htmlItem.style.transform = "translateY(0)";
              },
              150 + index * 50,
            ); // 150ms基本遅延 + 各要素50ms間隔
          } else {
            // 非表示にする要素：フェードアウト
            htmlItem.style.transition =
              "opacity 0.3s ease, transform 0.3s ease";
            htmlItem.style.opacity = "0";
            htmlItem.style.transform = "translateY(-10px)";
            setTimeout(() => {
              htmlItem.style.display = "none";
            }, 300);
          }
        });
      });
    });

    // 初期状態で全記事を表示
    newsItems.forEach((item) => {
      const htmlItem = item as HTMLElement;
      htmlItem.style.opacity = "1";
      htmlItem.style.transform = "translateY(0)";
      htmlItem.style.transition = "opacity 0.3s ease, transform 0.3s ease";
    });
  });
</script>

<style lang="scss">
  @import "../../styles/variables";
  @import "../../styles/functions";
  @import "../../styles/mixins";

  .news-list {
    padding-top: spx(296);
    position: relative;
    min-height: 90vh;
    padding-bottom: spx(99);
    @include tablet-up {
      padding-top: ppx(253 * 1.2);
      padding-bottom: ppx(228 * 1.2);
    }
    @include desktop-up {
      padding-top: ppx(253);
      padding-bottom: ppx(228);
    }

    &__container {
      padding-bottom: spx(100);
      @include tablet-up {
        padding-bottom: ppx(130 * 1.2);
      }
      @include desktop-up {
        padding-bottom: ppx(130);
      }
    }
  }

  .news-filter {
    display: flex;
    width: spx(680);
    padding: spx(40) spx(30);
    justify-content: center;
    align-items: flex-start;
    align-content: flex-start;
    gap: spx(10);
    flex-wrap: wrap;
    border-radius: spx(30);
    background: var(--base_2, #fcf2c9);
    margin-inline: auto;
    margin-top: spx(60);
    @include tablet-up {
      padding: ppx(40 * 1.2) ppx(85 * 1.2);
      gap: ppx(20 * 1.2);
      border-radius: ppx(30 * 1.2);
      width: ppx(1350 * 1.2);
      margin-top: ppx(91 * 1.2);
    }
    @include desktop-up {
      padding: ppx(40) ppx(85);
      gap: ppx(20);
      border-radius: ppx(30);
      width: ppx(1350);
      margin-top: ppx(91);
    }

    &__wrapper {
      display: flex;
      flex-wrap: wrap;
      gap: spx(10);
      justify-content: center;
      margin: 0 auto;
      width: 100%;
      @include tablet-up {
        gap: ppx(20 * 1.2);
      }
      @include desktop-up {
        gap: ppx(20);
      }
    }

    &__item {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: spx(10);
      border-radius: spx(15);
      width: spx(200);
      border: 2px solid var(--logo_color_3, #c99e2d);
      background: var(--base_1, #fffcf2);
      cursor: pointer;
      transition:
        background-color 0.3s ease,
        transform 0.2s ease;
      @include tablet-up {
        gap: ppx(10 * 1.2);
        border-radius: ppx(15 * 1.2);
        width: ppx(220 * 1.2);
      }
      @include desktop-up {
        gap: ppx(10);
        border-radius: ppx(15);
        width: ppx(220);
      }

      span {
        color: var(--logo_color_3, #c99e2d);
        text-align: center;
        font-size: spx(24);
        font-weight: 700;
        line-height: 180%;
        transition: color 0.3s ease;
        @include tablet-up {
          font-size: ppx(28 * 1.2);
        }
        @include desktop-up {
          font-size: ppx(28);
        }
      }

      @include hover {
        &:hover:not(&--active) {
          background: var(--base_2, #fcf2c9);
          transform: translateY(-2px);
          span {
            color: var(--logo_color_3, #c99e2d);
          }
        }
      }

      &--active {
        background: var(--logo_color_3, #c99e2d);
        @include tablet-up {
        }
        @include desktop-up {
        }
        span {
          color: var(--base_1, #fffcf2);
        }
      }
    }
  }

  .news-articles {
    margin-top: spx(80);
    @include tablet-up {
      margin-top: ppx(130 * 1.2);
    }
    @include desktop-up {
      margin-top: ppx(130);
    }
  }

  .news-pagination {
    margin-top: spx(40);
    width: spx(568);
    display: flex;
    justify-content: center;
    align-items: center;
    gap: spx(13);
    margin-inline: auto;
    position: relative;
    @include tablet-up {
      margin-top: ppx(90 * 1.2);
      width: ppx(750 * 1.2);
      gap: ppx(20 * 1.2);
    }
    @include desktop-up {
      margin-top: ppx(90);
      width: ppx(750);
      gap: ppx(20);
    }

    &__item {
      display: flex;
      width: spx(70);
      height: spx(70);
      padding: spx(10);
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: spx(10);
      flex-shrink: 0;
      aspect-ratio: 1/1;
      border-radius: spx(15);
      background: var(--white, #fff);
      @include tablet-up {
        width: ppx(90 * 1.2);
        height: ppx(90 * 1.2);
        padding: ppx(10 * 1.2);
        gap: ppx(10 * 1.2);
        border-radius: ppx(15 * 1.2);
      }
      @include desktop-up {
        width: ppx(90);
        height: ppx(90);
        padding: ppx(10);
        gap: ppx(10);
        border-radius: ppx(15);
      }

      &--prev {
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        @include tablet-up {
        }
        @include desktop-up {
        }
      }

      &--current {
        background: var(--base_6, #56b877);

        @include tablet-up {
        }
        @include desktop-up {
        }
        .news-pagination__text {
          color: white;
        }
      }

      &--next {
        position: absolute;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        @include tablet-up {
        }
        @include desktop-up {
        }
      }
    }

    &__text {
      color: var(--base_5, #102a4d);
      text-align: center;
      font-size: spx(26);
      font-weight: 700;
      line-height: 160%;
      @include tablet-up {
        font-size: ppx(33 * 1.2);
      }
      @include desktop-up {
        font-size: ppx(33);
      }
    }
  }
</style>

---
// コンポーネント
import PageLayout from "../layouts/PageLayout.astro";
import PageBottomWave from "../components/common/PageBottomWave.astro";
import Breadcrumb from "../components/common/Breadcrumb.astro";
import PageTitle from "../components/common/PageTitle.astro";

// 画像
import { getImage } from "astro:assets";
import archiveImage2024 from "../images/archive/img-2024.png";
import archiveImage2025 from "../images/archive/img-2025.png";

// アーカイブデータの定義
interface ArchiveItem {
  year: string;
  theme: string;
  date: string;
  image: ImageMetadata;
  link?: string;
}

const archiveItems: ArchiveItem[] = [
  {
    year: "2023",
    theme: "「ゆったり安らぐ のびのび遊ぶ」",
    date: "2023.12.2-3",
    image: archiveImage2024,
    link: "#",
  },
  {
    year: "2024",
    theme: "「ゆったり安らぐ のびのび遊ぶ」",
    date: "2024.12.7-8",
    image: archiveImage2025,
    link: "#",
  },
  {
    year: "2025",
    theme: "「ゆったり安らぐ のびのび遊ぶ」",
    date: "2025.12.6-7",
    image: archiveImage2025,
    link: "#",
  },
  {
    year: "2026",
    theme: "「ゆったり安らぐ のびのび遊ぶ」",
    date: "2026.12.5-6",
    image: archiveImage2025,
    link: "#",
  },
  {
    year: "2027",
    theme: "「ゆったり安らぐ のびのび遊ぶ」",
    date: "2027.12.4-5",
    image: archiveImage2025,
    link: "#",
  },
  {
    year: "2028",
    theme: "「ゆったり安らぐ のびのび遊ぶ」",
    date: "2028.12.2-3",
    image: archiveImage2025,
    link: "#",
  },
];

// 3つずつのグループに分割
function chunkArray<T>(array: T[], chunkSize: number): T[][] {
  const chunks: T[][] = [];
  for (let i = 0; i < array.length; i += chunkSize) {
    chunks.push(array.slice(i, i + chunkSize));
  }
  return chunks;
}

const archiveRows = chunkArray(archiveItems, 3);

// 画像の最適化処理
const optimizedImages = await Promise.all(
  archiveItems.map(async (item) => {
    const img = await getImage({
      src: item.image,
      format: "webp",
      widths: [500, 600],
    });
    return { ...item, optimizedImage: img };
  }),
);

const optimizedRows = chunkArray(optimizedImages, 3);
---

<PageLayout title="過去のコッコ祭り｜コッコ祭り 2025｜KOKKO Festival">
  <section class="page-wrapper archive">
    <div class="archive__header-wrapper">
      <PageTitle accent="過" title="去のコッコ祭り" subtitle="ARCHIVE" />
    </div>

    <main class="archive-content">
      <p class="archive-content__lead">これまでの開催記録をご覧いただけます</p>
      <div class="archive-content__grid">
        {
          optimizedRows.map((row) => (
            <div class="archive-content__row">
              {row.map((item) => (
                <a href={item.link || "#"} class="archive-item__link">
                  <article class="archive-item">
                    <figure class="archive-item__image">
                      <picture class="archive-item__picture">
                        <source
                          media="(min-width: 1024px)"
                          srcset={item.optimizedImage.srcSet.toString()}
                        />
                        <source
                          media="(min-width: 744px)"
                          srcset={item.optimizedImage.srcSet.toString()}
                        />
                        <img
                          src={item.optimizedImage.src}
                          alt={`${item.year}年コッコ祭りの様子`}
                          class="archive-item__img"
                        />
                      </picture>
                    </figure>
                    <h2 class="archive-item__year">{item.year}</h2>
                    <div class="archive-item__theme-label">テーマ</div>
                    <p class="archive-item__theme">{item.theme}</p>
                    <time class="archive-item__date">開催日：{item.date}</time>
                  </article>
                </a>
              ))}
            </div>
          ))
        }
      </div>
    </main>

    <Breadcrumb currentPageTitle="過去のコッコ祭り" />
    <PageBottomWave />
  </section>

  <style lang="scss">
    @import "../styles/variables";
    @import "../styles/functions";
    @import "../styles/mixins";

    .archive {
      padding-top: spx(296);
      position: relative;
      min-height: 90vh;
      padding-bottom: spx(99);
      @include tablet-up {
        padding-top: ppx(253 * 1.2);
        padding-bottom: ppx(228 * 1.2);
      }
      @include desktop-up {
        padding-top: ppx(253);
        padding-bottom: ppx(228);
      }

      &__header-wrapper {
        padding-bottom: spx(100);
        @include tablet-up {
          padding-bottom: ppx(130 * 1.2);
        }
        @include desktop-up {
          padding-bottom: ppx(130);
        }
      }
    }

    // Archive Content Block
    .archive-content {
      padding-bottom: spx(100);
      @include tablet-up {
        padding-bottom: ppx(130 * 1.2);
      }
      @include desktop-up {
        padding-bottom: ppx(130);
      }
      &__lead {
        color: var(--base_5, #102a4d);
        text-align: center;
        font-family: "Zen Kaku Gothic Antique";
        font-size: spx(26);
        font-style: normal;
        font-weight: 700;
        line-height: 180%; /* 46.8px */
        @include tablet-up {
          font-size: ppx(27 * 1.2);
        }
        @include desktop-up {
          font-size: ppx(27);
        }
      }

      &__grid {
        width: spx(600);
        margin-inline: auto;
        display: flex;
        flex-direction: column;
        gap: spx(40);
        margin-top: spx(60);
        @include tablet-up {
          width: auto;
          gap: ppx(90 * 1.2);
          margin-top: ppx(113 * 1.2);
        }
        @include desktop-up {
          gap: ppx(90);
          margin-top: ppx(113);
        }
      }

      &__row {
        display: flex;
        flex-direction: column;
        gap: spx(40);
        position: relative;
        @include tablet-up {
          display: grid;
          grid-template-columns: ppx(600 * 1.2) ppx(600 * 1.2) ppx(600 * 1.2);
          gap: ppx(80 * 1.2);
          justify-content: center;
          padding-bottom: ppx(90 * 1.2);
          width: max-content;
          margin-inline: auto;
        }
        @include desktop-up {
          grid-template-columns: ppx(600) ppx(600) ppx(600);
          gap: ppx(80);
          padding-bottom: ppx(90);
        }
        &:after {
          content: "";
          display: block;
          background: linear-gradient(
              to right,
              #102a4d,
              #102a4d 25%,
              rgba(0, 0, 0, 0) 25%,
              rgba(0, 0, 0, 0) 100%
            )
            0% 0%;
          background-size: 4px 1px;
          width: 100%;
          height: 1px;
          margin-left: auto;
          margin-right: auto;
          position: absolute;
          bottom: 0;
          left: 0;
        }
      }
    }

    // Archive Item Link
    .archive-item__link {
      text-decoration: none;
      display: block;
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    // Archive Item Block
    .archive-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: spx(10) 0 spx(40);
      position: relative;
      @include tablet-up {
        padding: 0;
      }
      @include desktop-up {
      }
      &::after {
        content: "";
        display: block;
        background: linear-gradient(
            to right,
            #102a4d,
            #102a4d 25%,
            rgba(0, 0, 0, 0) 25%,
            rgba(0, 0, 0, 0) 100%
          )
          0% 0%;
        background-size: 4px 1px;
        width: 100%;
        height: 1px;
        margin-left: auto;
        margin-right: auto;
        position: absolute;
        bottom: 0;
        left: 0;
        @include tablet-up {
          display: none;
        }
        @include desktop-up {
        }
      }

      &__image {
        width: spx(500);
        height: spx(500);
        border-radius: 50%;
        overflow: hidden;
        box-shadow: spx(2) spx(4) spx(15) 0 rgba(0, 0, 0, 0.25);
        @include tablet-up {
          width: ppx(600 * 1.2);
          height: ppx(600 * 1.2);
          box-shadow: ppx(2 * 1.2) ppx(4 * 1.2) ppx(15 * 1.2) 0
            rgba(0, 0, 0, 0.25);
        }
        @include desktop-up {
          width: ppx(600);
          height: ppx(600);
          box-shadow: ppx(2) ppx(4) ppx(15) 0 rgba(0, 0, 0, 0.25);
        }
      }

      &__picture {
        @include tablet-up {
        }
        @include desktop-up {
        }
      }

      &__img {
        display: block;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
        @include tablet-up {
        }
        @include desktop-up {
        }
      }

      &__year {
        color: var(--logo_color_3, #c99e2d);
        text-align: center;
        font-family: "Zen Kaku Gothic Antique";
        font-size: spx(64);
        font-style: normal;
        font-weight: 700;
        line-height: 100%; /* 64px */
        margin-top: spx(20);
        @include tablet-up {
          font-size: ppx(64 * 1.2);
          margin-top: ppx(25 * 1.2);
        }
        @include desktop-up {
          font-size: ppx(64);
          margin-top: ppx(25);
        }
      }

      &__theme-label {
        color: var(--base_5, #102a4d);
        text-align: center;
        font-family: "Zen Kaku Gothic Antique";
        font-size: spx(27);
        font-style: normal;
        font-weight: 700;
        line-height: 140%; /* 37.8px */
        margin-top: spx(20);
        transition: color 0.3s ease;
        @include tablet-up {
          font-size: ppx(27 * 1.2);
          margin-top: ppx(25 * 1.2);
        }
        @include desktop-up {
          font-size: ppx(27);
          margin-top: ppx(25);
        }
      }

      &__theme {
        color: var(--base_5, #102a4d);
        text-align: center;
        font-family: "Zen Kaku Gothic Antique";
        font-size: spx(33);
        font-style: normal;
        font-weight: 700;
        line-height: 140%; /* 46.2px */
        margin-top: spx(5);
        transition: color 0.3s ease;
        @include tablet-up {
          font-size: ppx(33 * 1.2);
          margin-top: ppx(5 * 1.2);
        }
        @include desktop-up {
          font-size: ppx(33);
          margin-top: ppx(5);
        }
      }

      &__date {
        color: var(--base_5, #102a4d);
        text-align: center;
        font-family: "Zen Kaku Gothic Antique";
        font-size: spx(27);
        font-style: normal;
        font-weight: 500;
        line-height: 200%; /* 54px */
        margin-top: spx(5);
        transition: color 0.3s ease;
        @include tablet-up {
          font-size: ppx(27 * 1.2);
          margin-top: ppx(5 * 1.2);
        }
        @include desktop-up {
          font-size: ppx(27);
          margin-top: ppx(5);
        }
      }
    }

    // Hover Effects
    .archive-item__link {
      @include hover {
        &:hover {
          .archive-item__theme-label,
          .archive-item__theme,
          .archive-item__date {
            color: var(--logo_color_3, #c99e2d);
          }

          .archive-item__img {
            transform: scale(1.1);
          }
        }
      }
    }
  </style>
</PageLayout>

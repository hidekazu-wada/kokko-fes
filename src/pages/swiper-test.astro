---
// Category Swiper Integration - Real Implementation
import "swiper/swiper-bundle.css";

// Import category images (mock paths for now)
// import logoOnlyCircle from "../images/common/logo-only-circle.svg";
// For demo, using placeholder data
const mockLogo = { src: "https://via.placeholder.com/80x80/c99e2d/fff?text=L" };
const mockFukidasi = { src: "https://via.placeholder.com/200x100/fcf2c9/102a4d?text=Bubble" };

// Mock category data
const categories = [
  { 
    id: 'play', 
    name: '遊ぶ', 
    accent: '遊',
    image: 'https://via.placeholder.com/1315x916/ff6b6b/fff?text=遊ぶ',
    description: '豊かな自然の中で思いっきり遊べる体験をご用意しています。アスレチックやアクティビティを通して、家族みんなで楽しい時間をお過ごしください。',
    bubble: 'うわぁ、高い!!\nゆらゆら揺れて楽しいな'
  },
  { 
    id: 'eat', 
    name: '食べる', 
    accent: '食',
    image: 'https://via.placeholder.com/1315x916/4ecdc4/fff?text=食べる',
    description: '地元の新鮮な食材を使った美味しいお料理をお楽しみいただけます。シェフ自慢の逸品から郷土料理まで、幅広いメニューをご用意しています。',
    bubble: 'ミシュランシェフ監修\n濃厚クラムチャウダー'
  },
  { 
    id: 'create', 
    name: '作る', 
    accent: '作',
    image: 'https://via.placeholder.com/1315x916/45b7d1/fff?text=作る',
    description: '手作り体験を通して、ものづくりの楽しさを感じてください。陶芸や工芸品作りなど、思い出に残る作品を作ることができます。',
    bubble: '世界にひとつだけの\n作品を作ろう'
  },
  { 
    id: 'see', 
    name: '見る', 
    accent: '見',
    image: 'https://via.placeholder.com/1315x916/f9ca24/fff?text=見る',
    description: '美しい景色や文化的な見どころがたくさんあります。四季折々の自然の美しさや、地域の歴史ある建造物をご覧いただけます。',
    bubble: '絶景スポットで\n記念撮影'
  },
  { 
    id: 'stay', 
    name: '泊まる', 
    accent: '泊',
    image: 'https://via.placeholder.com/1315x916/6c5ce7/fff?text=泊まる',
    description: '快適なお部屋で心地よい時間をお過ごしください。上質なサービスとアメニティで、特別なひとときをお楽しみいただけます。',
    bubble: '極上のおもてなしで\nリラックス'
  }
];
---

<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Category Swiper Integration</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
    }

    /* カテゴリーセクション - 元のスタイルを維持 */
    .category {
      background: var(--base_1, #fffcf2);
      padding: 20px 0 60px;
    }

    .category__wave {
      display: block;
      width: 100%;
    }
    .category__wave path {
      fill: var(--base_2, #fcf2c9);
    }

    .category__header {
      margin-top: 70px;
      text-align: center;
    }

    .category__title-text {
      display: block;
      color: var(--base_5, #102a4d);
      font-size: 38px;
      line-height: 120%;
      font-weight: 700;
    }
    .category__title-text.large {
      font-size: 76px;
    }

    /* ナビゲーション（サムネイルSwiper） */
    .category__nav {
      margin-top: 40px;
      position: relative;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      overflow: hidden;
    }

    .category__nav-list {
      /* Swiperのwrapperとして機能 */
      display: flex;
      align-items: center;
      justify-content: flex-start; /* Swiperで横スクロール */
      gap: 15px;
      transition: transform 0.3s ease;
    }

    .category__nav-item {
      /* Swiperのslideとして機能 */
      position: relative;
      width: 108px;
      height: 108px;
      cursor: pointer;
      border-radius: 50%;
      flex-shrink: 0; /* Swiperで重要 */
      transition: all 0.3s ease;
    }

    .category__nav-item:hover .circle path {
      fill: var(--base_2, #fcf2c9);
    }

    .category__nav-item span {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: var(--base_5, #102a4d);
      font-size: 23px;
      font-weight: 700;
      line-height: 180%;
      white-space: nowrap;
      transition: color 0.3s ease;
      z-index: 2;
    }

    .category__nav-item .circle {
      display: block;
      width: 100%;
      height: 100%;
    }
    .category__nav-item .circle path {
      fill: white;
      transition: fill 0.3s ease;
    }

    /* アクティブなサムネイル */
    .category__nav-item.swiper-slide-thumb-active .circle path {
      fill: var(--logo_color_3, #c99e2d);
    }
    .category__nav-item.swiper-slide-thumb-active span {
      color: white;
    }

    /* コンテンツ（メインSwiper） */
    .category__content {
      margin-top: 40px;
      height: auto;
      overflow: hidden;
    }

    .category__content-wrapper {
      display: flex;
      transition: transform 0.3s ease;
    }

    .category__item {
      width: 100%;
      flex-shrink: 0;
      padding: 0 20px;
      box-sizing: border-box;
    }

    .category__item-header {
      display: flex;
      align-items: center;
      gap: 20px;
      justify-content: center;
      margin-bottom: 20px;
    }

    .category__item-icon {
      display: block;
      width: 80px;
      height: 80px;
      border-radius: 50%;
    }

    .category__item-title {
      color: #000;
      font-size: 83px;
      font-weight: 700;
      line-height: 130%;
      margin: 0;
    }

    .category__item-title-accent {
      color: var(--logo_color_3, #c99e2d);
    }

    .category__item-description {
      color: var(--base_5, #102a4d);
      font-size: 28px;
      font-weight: 700;
      line-height: 180%;
      width: 560px;
      margin: 20px auto;
      text-align: center;
    }

    .category__item-figure {
      position: relative;
      width: max-content;
      margin: 79px auto 0;
    }

    .category__item-image {
      display: block;
      width: 660px;
      height: 460px;
      object-fit: cover;
      border-radius: 45px 0 0 45px;
    }

    .category__item-bubble {
      position: absolute;
      top: -69px;
      right: 52px;
      width: 200px;
      height: 100px;
    }

    .category__item-bubble-bg {
      width: 100%;
      height: 100%;
    }

    .category__item-bubble-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: var(--base_5, #102a4d);
      font-size: 18px;
      font-weight: 700;
      text-align: center;
      line-height: 150%;
      white-space: pre-line;
    }

    .category__item-footer {
      margin-top: 40px;
      text-align: center;
    }

    .category__item-link {
      display: inline-block;
      color: var(--logo_color_3, #c99e2d);
      font-size: 24px;
      font-weight: 700;
      text-decoration: none;
      padding: 15px 30px;
      border: 2px solid var(--logo_color_3, #c99e2d);
      border-radius: 25px;
      transition: all 0.3s ease;
    }

    .category__item-link:hover {
      background: var(--logo_color_3, #c99e2d);
      color: white;
    }

    /* Debug info */
    .debug-info {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 10px;
      border-radius: 5px;
      font-size: 12px;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <div class="debug-info">
    Active Slide: <span id="debug-active">0</span>
  </div>

  <section class="category">
    <svg class="category__wave" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2559 170" fill="none">
      <path d="M0 169.5V82C0 82 213 15.5 639.5 15.5C1066 15.5 1279.5 82 1279.5 82C1279.5 82 1493 15.5 1919.5 15.5C2346 15.5 2559 82 2559 82V169.5H0Z" />
    </svg>

    <header class="category__header">
      <h2 class="category__title">
        <span class="category__title-text">コッコ祭りを</span>
        <span class="category__title-text large">楽しむ</span>
      </h2>
    </header>

    <!-- ナビゲーション（サムネイルSwiper） -->
    <nav class="category__nav swiper" id="categoryNavSwiper">
      <ul class="category__nav-list swiper-wrapper">
        {categories.map((category) => (
          <li class="category__nav-item swiper-slide">
            <span>{category.name}</span>
            <svg class="circle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 148 148" fill="none">
              <path d="M148 74C148 114.869 114.869 148 74 148C33.1309 148 0 114.869 0 74C0 33.1309 33.1309 0 74 0C114.869 0 148 33.1309 148 74Z"/>
            </svg>
          </li>
        ))}
      </ul>
    </nav>

    <!-- コンテンツ（メインSwiper） -->
    <section class="category__content swiper" id="categoryContentSwiper">
      <div class="category__content-wrapper swiper-wrapper">
        {categories.map((category) => (
          <article class={`category__item category__item--${category.id} swiper-slide`}>
            <header class="category__item-header">
              <img
                src={mockLogo.src}
                alt=""
                class="category__item-icon"
              />
              <h3 class="category__item-title">
                <span class="category__item-title-accent">{category.accent}</span>{category.name.slice(1)}
              </h3>
            </header>
            <p class="category__item-description">
              {category.description}
            </p>
            <figure class="category__item-figure">
              <picture class="category__item-picture">
                <img 
                  src={category.image}
                  alt={category.name}
                  class="category__item-image"
                />
              </picture>
              <div class="category__item-bubble">
                <img
                  src={mockFukidasi.src}
                  alt="吹き出し"
                  class="category__item-bubble-bg"
                />
                <div class="category__item-bubble-text">
                  {category.bubble}
                </div>
              </div>
            </figure>
            <footer class="category__item-footer">
              <a href="#" class="category__item-link">
                <div class="category__item-link-text">MORE ＞</div>
              </a>
            </footer>
          </article>
        ))}
      </div>
    </section>
  </section>

  <script>
    import Swiper from 'swiper';

    console.log('=== CATEGORY SWIPER INTEGRATION ===');

    document.addEventListener('DOMContentLoaded', function() {
      console.log('Initializing Category Swipers...');
      
      try {
        // ① サムネイルSwiper（ナビゲーション）
        const thumbsSwiper = new Swiper("#categoryNavSwiper", {
          slidesPerView: 'auto',
          spaceBetween: 15,
          centeredSlides: true,
          freeMode: true,
          watchSlidesProgress: true,
          
          // デバッグ用
          on: {
            click: function(swiper, event) {
              console.log('Thumb clicked:', swiper.clickedIndex);
            }
          }
        });
        console.log('Navigation Swiper created:', thumbsSwiper);

        // ② メインSwiper（コンテンツ）
        const mainSwiper = new Swiper("#categoryContentSwiper", {
          slidesPerView: 1,
          spaceBetween: 0,
          
          // サムネイル連動
          thumbs: {
            swiper: thumbsSwiper,
          },
          
          // デバッグ・UI更新
          on: {
            slideChange: function() {
              const activeIndex = this.activeIndex;
              console.log('Content slide changed to:', activeIndex);
              
              // デバッグ情報更新
              const debugElement = document.getElementById('debug-active');
              if (debugElement) {
                debugElement.textContent = activeIndex;
              }
            }
          }
        });
        console.log('Content Swiper created:', mainSwiper);

        console.log('Swiper connection:', mainSwiper.thumbs?.swiper === thumbsSwiper);

        // 手動でサムネイルクリックイベントを強化
        const navItems = document.querySelectorAll('.category__nav-item');
        navItems.forEach((item, index) => {
          item.addEventListener('click', function() {
            console.log(`Manual nav click: ${index}`);
            mainSwiper.slideTo(index);
          });
        });

        // 初期状態でデバッグ情報を設定
        setTimeout(() => {
          const debugElement = document.getElementById('debug-active');
          if (debugElement) {
            debugElement.textContent = mainSwiper.activeIndex;
          }
        }, 100);

      } catch (error) {
        console.error('Error creating Category Swipers:', error);
      }
    });
  </script>
</body>
</html>
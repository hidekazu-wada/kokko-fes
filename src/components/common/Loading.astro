---
import logoOnlyCircle from "../../images/common/logo-only-circle.svg";
---

<div class="loading" id="loading">
  <figure class="loading__figure">
    <img src={logoOnlyCircle.src} alt="" class="loading__image" />
  </figure>
</div>

<script>
  // 初回訪問判定とローディング画面制御
  const loadingElement = document.getElementById('loading');
  const VISITED_KEY = 'kuwarubi_visited';
  
  // 初回訪問かチェック
  const hasVisited = localStorage.getItem(VISITED_KEY);
  
  if (hasVisited) {
    // 2回目以降の訪問 - ローディング画面を即座に非表示
    if (loadingElement) {
      loadingElement.style.display = 'none';
    }
  } else {
    // 初回訪問 - ローディング画面を表示し、3秒後にフェードアウト
    localStorage.setItem(VISITED_KEY, 'true');
    
    setTimeout(() => {
      if (loadingElement) {
        loadingElement.style.transition = 'opacity 0.5s ease-out';
        loadingElement.style.opacity = '0';
        
        // フェードアウト完了後に要素を削除
        setTimeout(() => {
          loadingElement.style.display = 'none';
        }, 500);
      }
    }, 3000);
  }
</script>

<style lang="scss">
  @import "../../styles/variables";
  @import "../../styles/functions";
  @import "../../styles/mixins";

  .loading {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1000;
    @include tablet-up {
    }
    @include desktop-up {
    }

    &__figure {
      background-color: white;
      width: 100%;
      height: 100vh;
      display: grid;
      place-items: center;
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    &__image {
      display: block;
      width: spx(200);
      height: spx(200);
      animation: loadingRotate 5s linear infinite;
      @include tablet-up {
        width: tpx(320);
        height: tpx(320);
      }
      @include desktop-up {
        width: ppx(240);
        height: ppx(240);
      }
    }
  }

  @keyframes loadingRotate {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }
</style>

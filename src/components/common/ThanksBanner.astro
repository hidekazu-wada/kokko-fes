---
import ThanksBannerInner from "./ThanksBannerInner.astro";
import ThanksBannerBuyTicket from "./ThanksBannerBuyTicket.astro";
---

<section class="event-thanks" data-thanks-banner>
  <!-- イベント終了後に有効にするコンポーネント -->
  <ThanksBannerInner visitors="650" booths="28" />
  <!-- イベント終了後に無効にするコンポーネント -->
  <!-- <ThanksBannerBuyTicket /> -->
</section>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const thanksBanner = document.querySelector(
      "[data-thanks-banner]",
    ) as HTMLElement;
    const footer = document.querySelector(".footer") as HTMLElement;

    if (!thanksBanner || !footer) return;

    // 初期状態を設定
    let isHidden = false;

    // スクロールイベントの処理
    const handleScroll = () => {
      const footerTop = footer.getBoundingClientRect().top;
      const windowHeight = window.innerHeight;

      // Footerの上部がビューポートの下端に到達したかチェック
      if (footerTop <= windowHeight && !isHidden) {
        // バナーを非表示
        thanksBanner.style.transform = "translateY(100%)";
        thanksBanner.style.opacity = "0";
        isHidden = true;
      } else if (footerTop > windowHeight && isHidden) {
        // バナーを表示
        thanksBanner.style.transform = "translateY(0)";
        thanksBanner.style.opacity = "1";
        isHidden = false;
      }
    };

    // スクロールイベントの最適化（throttle）
    let ticking = false;
    const scrollHandler = () => {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          handleScroll();
          ticking = false;
        });
        ticking = true;
      }
    };

    // イベントリスナーを追加
    window.addEventListener("scroll", scrollHandler);

    // 初回実行
    handleScroll();
  });
</script>

<style lang="scss">
  /* 必要なmixin/functionをインポート */
  @import "../../styles/variables";
  @import "../../styles/functions";
  @import "../../styles/mixins";

  // Event Thanks Block
  .event-thanks {
    position: fixed;
    left: 0;
    bottom: 0;
    width: 100%;
    background: var(--logo_color_3, #c99e2d);
    padding: spx(27) 0;
    display: flex;
    flex-flow: column;
    align-items: center;
    gap: spx(12);
    z-index: 10;
    transition:
      transform 0.3s ease,
      opacity 0.3s ease;
    @include tablet-up {
      flex-direction: row;
      padding: tpx(30) 0;
      gap: tpx(120);
      justify-content: center;
    }
    @include desktop-up {
      padding: ppx(28) 0;
      gap: ppx(79);
    }
  }
</style>
